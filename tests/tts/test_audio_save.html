<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTSéŸ³é¢‘ä¿å­˜åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <h1>ğŸµ TTSéŸ³é¢‘ä¿å­˜åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ æµ‹è¯•è¯´æ˜</h2>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•TTSæ‰©å±•çš„éŸ³é¢‘è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ã€‚</p>
        <ol>
            <li>ç¡®ä¿TTSæ‰©å±•å·²å®‰è£…å¹¶å¯ç”¨</li>
            <li>é€‰ä¸­ä¸‹é¢çš„æµ‹è¯•æ–‡æœ¬</li>
            <li>å³é”®é€‰æ‹©"AIè¯­éŸ³æ’­æ”¾é€‰ä¸­æ–‡æœ¬"</li>
            <li>è§‚å¯Ÿæ˜¯å¦è‡ªåŠ¨ä¿å­˜éŸ³é¢‘æ–‡ä»¶</li>
        </ol>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“ æµ‹è¯•æ–‡æœ¬</h2>
        <p id="testText" style="background: #e9ecef; padding: 15px; border-radius: 5px; cursor: pointer;">
            è¿™æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯•TTSéŸ³é¢‘ä¿å­˜åŠŸèƒ½çš„ç¤ºä¾‹æ–‡æœ¬ã€‚è¯·é€‰ä¸­è¿™æ®µæ–‡å­—ï¼Œç„¶åå³é”®é€‰æ‹©"AIè¯­éŸ³æ’­æ”¾é€‰ä¸­æ–‡æœ¬"æ¥æµ‹è¯•è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ã€‚å¦‚æœè®¾ç½®æ­£ç¡®ï¼ŒéŸ³é¢‘æ–‡ä»¶åº”è¯¥ä¼šè‡ªåŠ¨ä¸‹è½½åˆ°æ‚¨çš„ä¸‹è½½æ–‡ä»¶å¤¹ä¸­ã€‚
        </p>
        <button class="test-button" onclick="selectTestText()">é€‰ä¸­æµ‹è¯•æ–‡æœ¬</button>
    </div>
    
    <div class="test-section">
        <h2>âš™ï¸ è®¾ç½®æ£€æŸ¥</h2>
        <div id="settingsStatus" class="info">
            æ­£åœ¨æ£€æŸ¥æ‰©å±•è®¾ç½®...
        </div>
        <button class="test-button" onclick="checkSettings()">æ£€æŸ¥è®¾ç½®</button>
    </div>
    
    <div class="test-section">
        <h2>ğŸ”§ åŠŸèƒ½æµ‹è¯•</h2>
        <button class="test-button" onclick="testAutoSave()">æµ‹è¯•è‡ªåŠ¨ä¿å­˜</button>
        <button class="test-button" onclick="testManualSave()">æµ‹è¯•æ‰‹åŠ¨ä¿å­˜</button>
        <div id="testResults"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“Š è°ƒè¯•ä¿¡æ¯</h2>
        <button class="test-button" onclick="showDebugInfo()">æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯</button>
        <div id="debugInfo"></div>
    </div>

    <script>
        // é€‰ä¸­æµ‹è¯•æ–‡æœ¬
        function selectTestText() {
            const textElement = document.getElementById('testText');
            const range = document.createRange();
            range.selectNodeContents(textElement);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            
            showStatus('æµ‹è¯•æ–‡æœ¬å·²é€‰ä¸­ï¼Œè¯·å³é”®é€‰æ‹©"AIè¯­éŸ³æ’­æ”¾é€‰ä¸­æ–‡æœ¬"', 'info');
        }
        
        // æ£€æŸ¥è®¾ç½®
        function checkSettings() {
            if (typeof chrome !== 'undefined' && chrome.storage) {
                chrome.storage.sync.get(['autoSaveAudio', 'saveFormat'], function(result) {
                    const autoSave = result.autoSaveAudio !== false;
                    const saveFormat = result.saveFormat || 'wav';
                    
                    document.getElementById('settingsStatus').innerHTML = `
                        <strong>å½“å‰è®¾ç½®ï¼š</strong><br>
                        è‡ªåŠ¨ä¿å­˜ï¼š${autoSave ? 'âœ… å¯ç”¨' : 'âŒ ç¦ç”¨'}<br>
                        ä¿å­˜æ ¼å¼ï¼š${saveFormat.toUpperCase()}
                    `;
                    document.getElementById('settingsStatus').className = autoSave ? 'success' : 'error';
                });
            } else {
                document.getElementById('settingsStatus').innerHTML = 'âŒ æ— æ³•è®¿é—®æ‰©å±•è®¾ç½®';
                document.getElementById('settingsStatus').className = 'error';
            }
        }
        
        // æµ‹è¯•è‡ªåŠ¨ä¿å­˜
        function testAutoSave() {
            showStatus('è¯·é€‰ä¸­æ–‡æœ¬å¹¶ä½¿ç”¨å³é”®èœå•æµ‹è¯•è‡ªåŠ¨ä¿å­˜åŠŸèƒ½', 'info');
        }
        
        // æµ‹è¯•æ‰‹åŠ¨ä¿å­˜
        function testManualSave() {
            showStatus('è¯·å…ˆæ’­æ”¾éŸ³é¢‘ï¼Œç„¶åä½¿ç”¨æ’­æ”¾å™¨ä¸­çš„ä¿å­˜æŒ‰é’®', 'info');
        }
        
        // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
        function showDebugInfo() {
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.sendMessage({ action: "getDebugInfo" }, function(response) {
                    if (response) {
                        const stats = response.messageStats;
                        const health = response.connectionHealth;
                        
                        document.getElementById('debugInfo').innerHTML = `
                            <h3>æ¶ˆæ¯ç»Ÿè®¡</h3>
                            <p>æ€»å‘é€: ${stats.totalSent}</p>
                            <p>æˆåŠŸ: ${stats.successful}</p>
                            <p>å¤±è´¥: ${stats.failed}</p>
                            <p>æˆåŠŸç‡: ${stats.totalSent > 0 ? ((stats.successful / stats.totalSent) * 100).toFixed(1) : 0}%</p>
                            <p>å¹³å‡å“åº”æ—¶é—´: ${stats.averageResponseTime.toFixed(0)}ms</p>
                            <p>é‡è¯•æ¬¡æ•°: ${stats.retries}</p>
                            
                            <h3>è¿æ¥å¥åº·</h3>
                            ${Object.keys(health).length > 0 ? 
                                Object.entries(health).map(([tabId, info]) => 
                                    `<p>Tab ${tabId}: ${info.isHealthy ? 'âœ… å¥åº·' : 'âŒ ä¸å¥åº·'} (${info.responseTime}ms)</p>`
                                ).join('') : 
                                '<p>æš‚æ— è¿æ¥ä¿¡æ¯</p>'
                            }
                        `;
                    } else {
                        document.getElementById('debugInfo').innerHTML = 'âŒ æ— æ³•è·å–è°ƒè¯•ä¿¡æ¯';
                    }
                });
            } else {
                document.getElementById('debugInfo').innerHTML = 'âŒ æ‰©å±•æœªåŠ è½½';
            }
        }
        
        // æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
        function showStatus(message, type) {
            const resultsDiv = document.getElementById('testResults');
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            resultsDiv.appendChild(statusDiv);
            
            // 5ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (statusDiv.parentNode) {
                    statusDiv.remove();
                }
            }, 5000);
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥è®¾ç½®
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkSettings, 1000);
        });
    </script>
</body>
</html>
